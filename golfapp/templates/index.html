{% extends "base.html" %}

{% block title %}View Rounds{% endblock title %}
{% block home %}active{% endblock home %}


{% block content %}
<script>
    const GET_PAGE_URL = "{{ url_for('home.get_page') }}";
    const DELETE_ROUND_URL = "{{ url_for('home.delete_round', id=0) }}".slice(0, -1);
    const COURSES = {{ courses|tojson }};
</script>
<script src="/static/js/createElement.js"></script>
<script src="/static/js/pagination.js"></script>
<script src="/static/js/round.js"></script>
<script>
    const TOTAL_ROUNDS = {{ total }};
    const CURRENT_PAGE = {{ page }};
    const NUM_PAGES = {{ num_pages }};

    const parser = new DOMParser();
    const roundsArray = [];
    const roundsPy = {{ rounds|tojson }};
    for (let r of roundsPy) {
        let round = new Round(...r);
        roundsArray.push(round);
    }
</script>
<script>
    const TOGGLE_VISIBILITY_URL = "{{ url_for('home.toggle_user_visibilty') }}";
    function deleteRoundClick(id) {
        document.getElementById(`delete_id${id}`).style.display = 'block';
    }
    function toggleHidden(eles) {
        for (let ele of eles) {
            ele.hidden = !ele.hidden;
        }
    }
    function toggleEditElements(id) {
        let editEles = document.querySelectorAll(`.show-edit-${id}`);
        toggleHidden(editEles);
        let nonEditEles = document.querySelectorAll(`.show-not-edit-${id}`);
        toggleHidden(nonEditEles);
    }
    function cancelEditRound(id) {
        toggleEditElements(id);
    }
    function editRound(id) {
        toggleEditElements(id);
    }
</script>

<div class="container-fluid">
    <div class="container pb-5">
        <div class="fw-bold fs-1">
            Your handicap is {{ handicap }}
        </div>
        <div>
            <a href="{{ url_for('home.stats') }}">View more stats</a>
        </div>
        <!-- <div class="m-2">
            Show your handicap on the <a href="{{ url_for('home.view_players') }}">View Players</a> page?
            <div class="form-check form-switch ms-3" style="display:inline-block;">
                <input class="form-check-input" type="checkbox" id="showHandicapToggle" {% if is_visible %}checked{% endif %}>
                <label class="form-check-label" for="showHandicapToggle"></label>
            </div>
        </div> -->
        <!-- <div>
            <p class="fs-4 m-2 fw-bold">Stats for last 20 rounds</p>
            <p class="m-2"><b>{{ stats['num_rounds'] }}</b> rounds recorded</p>
            <p class="m-2">Average round: <b>{{ stats['avg_score'] }}</b></p>
            <p class="m-2">Fairways in regulation: <b>{{ stats['avg_fir'] }}</b></p>
            <p class="m-2">Greens in regulation: <b>{{ stats['avg_gir'] }}</b></p>
            <p class="m-2">Putting: <b>{{ stats['avg_putts'] }}</b></p>
        </div> -->
    </div>
</div>
<div class="container-fluid mb-5">
    <div class="container">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Course</th>
                        <th scope="col">Score / Par</th>
                        <th scope="col w-80p">FIR</th>
                        <th scope="col w-80p">GIR</th>
                        <th scope="col w-80p">Putts</th>
                        <th scope="col">Date</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <form action="{{ url_for('home.add_round_submit') }}" method="POST">
                            <td>
                                <select name="course" id="course" class="form-select"
                                    aria-label="Default select example" style="max-width: 350px;">
                                </select>
                            </td>
                            <td class="w-140p">
                                <input class="form-control w-80p" type="number" name="score" placeholder="Score"
                                    required>
                            </td>
                            <td>
                                <input class="form-control w-80p" type="number" name="fir" placeholder="FIR">
                            </td>
                            <td>
                                <input class="form-control w-80p" type="number" name="gir" placeholder="GIR">
                            </td>
                            <td>
                                <input class="form-control w-80p" type="number" name="putts" placeholder="Putts">
                            </td>
                            <td>
                                <input class="form-control" type="date" id="date" name="date" placeholder="">
                            </td>
                            <td>
                                <input class="btn btn-primary" type="submit" value="Add Round">
                            </td>
                        </form>
                    </tr>

                    <div id="rounds"></div>
                </tbody>
            </table>
        </div>

        <nav aria-label="...">
            <ul class="pagination">
                <li id="prev" class="page-item">
                    <button class="page-link">
                        <span aria-hidden="true">&laquo;</span>
                    </button>
                </li>
                <li id="next" class="page-item">
                    <button class="page-link">
                        <span aria-hidden="true">&raquo;</span>
                    </button>
                </li>
            </ul>
        </nav>
    </div>
</div>

<div id="deleteModals"></div>

<script src="/static/js/setdate.js"></script>
<script>
    let coursesArray = [];
    for (let [id, course] of Object.entries(COURSES)) {
        coursesArray.push(course);
    }

    coursesArray.sort((a, b) => a.name > b.name);

    let selectCourse = document.getElementById("course");

    for (let course of coursesArray) {
        let courseOption = createElement({
            type: "option",
            value: course.id,
            content: `${course.name} - ${course.teebox} (${course.rating} / ${course.slope})`
        });
        selectCourse.appendChild(courseOption);
    }


    const pagination = new Pagination(roundsArray, TOTAL_ROUNDS, CURRENT_PAGE, NUM_PAGES);
    // let visibilityToggle = document.getElementById("showHandicapToggle");
    // visibilityToggle.addEventListener("click", event => {
    //     console.log("Should show?", event.target.checked);
    //     return new Promise(function (resolve, reject) {
    //         var xmlHttp = new XMLHttpRequest();
    //         xmlHttp.open("GET", TOGGLE_VISIBILITY_URL + `?isVisible=${event.target.checked}`);
    //         xmlHttp.onload = () => {
    //             resolve(xmlHttp.response);
    //         };
    //         xmlHttp.send(null);
    //     })
    // });

</script>

{% endblock content %}